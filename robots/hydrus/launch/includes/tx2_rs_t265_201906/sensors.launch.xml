<?xml version="1.0"?>
<launch>

  <arg name="real_machine" default="false" />
  <arg name="simulation" default="false" />

  <group if="$(arg real_machine)">
    <group unless="$(arg simulation)">
      <!-- fc & IMU & GPS -->
      <include file="$(find spinal_ros_bridge)/launch/serial.launch" >
        <arg name="baud" value="921600" />
        <arg name="port" value="/dev/flight_controller" />
      </include>

      <!-- vo by realsense t265 -->
      <include file="$(find realsense2_camera)/launch/rs_t265.launch" >
        <arg name="enable_sync" value="false"/>
      </include>
      <param name="/camera/realsense2_camera/publish_odom_tf" value="false" />

      <!-- mocap -->
      <include file="$(find aerial_robot_base)/launch/external_module/mocap.launch" />

      <!-- leddar one -->
      <include file="$(find leddar_one)/launch/leddar_one.launch" />
    </group>
    <group if="$(arg simulation)">
      <node pkg="nodelet" type="nodelet" name="realsense2_camera_manager" ns="camera" args="manager" />
    </group>

    <!-- throttle for vo odom from realsense t265 -->
    <node pkg="nodelet" type="nodelet"  name="throttle"
          args="load jsk_topic_tools/LightweightThrottle /camera/realsense2_camera_manager">
      <remap from="~input" to="/camera/odom/sample" />
      <remap from="~output" to="/vo/odom" />
      <param name="update_rate" value="80.0" /> <!-- not equal to fps -->
    </node>
  </group>

  <!-- basic configuration for sensors (e.g. noise sigma) -->
  <rosparam file="$(find hydrus)/config/sensors/imu/spinal.yaml" command="load" />
  <rosparam file="$(find aerial_robot_base)/config/sensors/gps/ublox_m8n.yaml" command="load" />
  <rosparam file="$(find hydrus)/config/sensors/vo/realsense_t265.yaml" command="load" />
  <rosparam file="$(find aerial_robot_base)/config/sensors/mocap.yaml" command="load" />
  <rosparam file="$(find aerial_robot_base)/config/sensors/altmeter/leddar_one.yaml" command="load" />
</launch>
